<html>
    <head>
        <title>IS 289 - Dianne Weinthal</title>
        <meta charset='utf-8'>
        <script type="text/javascript" src='js/jquery.js '></script>
        <script type="text/javascript" src='js/tabletop1.3.4.js'></script>
        <script type="text/javascript" src='js/sheetsee.js'></script>
        <script type="text/javascript" src='js/leaflet.markercluster.js'></script>

        <link rel="shortcut icon" href="https://raw.github.com/jlord/hack-spots/master/favico.png"/>

        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link href='https://api.tiles.mapbox.com/mapbox.js/v1.4.0/mapbox.css' rel='stylesheet' />
        <link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic'>
        <link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Amatic+SC:400,700'>
        <link media="screen" rel="stylesheet" type="text/css" href="css/style.css">
        <link media="screen" rel="stylesheet" type="text/css" href="css/site.css">
        <link rel="stylesheet" href="css/MarkerCluster.css" />
        <link rel="stylesheet" href="css/MarkerCluster.Default.css" />

    </head>
<body>
    <div id="wrapper">
        <h1>GASOLINE STATIONS</h1>
        <h2>Spatial Analysis of a Photography Archive</h2>
        <div>
            <ul class="nav">
                 <li><a href="#info">INFO</a> -</li>
                <li><a href="#rightSide">MAP</a> -</li>
                <li><a href="#analysis">ANALYSIS</a> -</li>
                <li><a href="#image">IMAGES</a> -</li>
                <li><a href="#data">DATA</a> -</li>
                <li><a href="#contact">CONTACT</a> -</li>
                <li><a href="#contributors">CONTRIBUTORS</a> -</li>
                <li><a href="https://github.com/dianneweinthal/IS289-photo-archive">GITHUB</a> </li>

            </ul>
        </div>
        <br> 
        
         <div id="info" class="container">
            <h3>INFO</h3>
                    <p> Since 2013, I have been photographing gas stations across California and the Southwest. The collection includes iPhone documentation, which captured latitude and longitude coordinates for each image. Extracting these metadata elements offers an opportunity to see my own trajectory on the road, and more broadly, build a method to look at creative process in relationship to space.</p>
                    <p> This project examines a relatively small sample set of images to implement its method of analysis. As of December 2018, the total archive includes 2839 files. Many are digitized negatives and print scans from Fujifilm FP-100C peel-apart film, shot on a Polaroid Land camera. Because these images are scanned after the fact, their metadata does not reflect the same spatial information as the iPhone digital files. The scope of this project was therefore limited to a recent sample of iPhone images, taken from February to September, 2018, for the sake of accurate analysis.</p> 
                    <p> Created in Fall 2018 for UCLA Information Studies 289: Digital Methods for Research and Scholarship </p>
    </div>  
        
        <div class="container">
            <div id="rightSide">
                <div id="latestSpot"></div>
                <div id="selectedSpot"></div>
            </div>
            <div id="map"></div>
        </div>
        <div class="container">
            <input id="tableFilter" type="text" placeholder="filter by.."></input>
            <span class="clear button">Clear</span> <span class="resetMap button">Reset Map</span>
            <span class="noMatches">no matches</span>
            <div id="hackSpotsTable"></div>
        </div>
    
         <div id="analysis">
             <h3>ANALYSIS</h3>
insert text on charts
             <iframe width="600" height="371" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRCnqHQqAlCPK7Ewbq0wGjQmC6VrILq7DDuV7RE9hTgh0J8D7P_kRC9Xxguo6AzBjj9jCXAXRJa8k6M/pubchart?oid=994433244&amp;format=interactive"></iframe>
    <iframe width="600" height="371" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRCnqHQqAlCPK7Ewbq0wGjQmC6VrILq7DDuV7RE9hTgh0J8D7P_kRC9Xxguo6AzBjj9jCXAXRJa8k6M/pubchart?oid=484058409&amp;format=interactive"></iframe>
   insert text on analysis of visual images by metadata elements
    </div>
    
        
        <div id="image" class="container"> 
            <h4><i>Try filtering by city name or gas station brand...</i></h4></div>

        <div id="cp_widget_03cb520a-381d-49be-a20e-e6f1125fd18a">...</div><script type="text/javascript">
var cpo = []; cpo["_object"] ="cp_widget_03cb520a-381d-49be-a20e-e6f1125fd18a"; cpo["_fid"] = "AsLAmZu_xIwK";
var _cpmp = _cpmp || []; _cpmp.push(cpo);
(function() { var cp = document.createElement("script"); cp.type = "text/javascript";
cp.async = true; cp.src = "//www.cincopa.com/media-platform/runtime/libasync.js";
var c = document.getElementsByTagName("script")[0];
c.parentNode.insertBefore(cp, c); })(); </script>
    
    <div id="data" class="container">
            <h3> DATA </h3>
                <div id="theNumberofSpots"></div>
        <p>And is available on this <a href="https://docs.google.com/spreadsheets/d/1bsqzhvvRqvrhDRYkiqRiApKSIC7bojCXlRPPEX7pVaE/edit#gid=0" target="_blank">Google Spreadsheet</a>. </p>
            <p>Visualizations are linked directly to this data -- so anytime a new gas station is added to the sheet, the count, map, and charts automatically update.</p>
      <p>Digital assets also include image files, metadata extractions, source code, and repository backups.</p>
                  <h4> Methodology </h4>
                    <p> This project implements <b>metadata extraction, data structuring, geocoding, data visualization, and static site creation with HTML, CSS, and JavaScript</b>. For more information on the analytic and display tools used, see the <a href=#contributors>Contributors</a> section. </p>    
</p>            
        <p> The workflow developed with these methods can easily be adapted for other archives. Approaching spatial metadata, for photographs in particular, allows for questions and (hopefully) some interesting answers not typically prioritized in visual art files.</p>
   
        <h4>Standards</h4>
            <ul>
                <li>Use open source tools whenever possible</li>
                <li>Build with expansion in mind</li>
                <li>Keep a copy of version history and digital assets saved locally</li>
            </ul>
             <h4>Image Formats</h4>
            <ul>
                <li>JPEGs from original iPhone upload: 4032 x 3024 px at 72 ppi, approximately 2 MB</li>
                <li>JPEGs reformatted for web display; batch export from Adobe Lightroom with custom preset for 1500 px on longest side at 72 ppi, including all metadata and copyright, approx 400 KB</li>
            </ul>
            <h4> Sustainability </h4>
                    <p> text </p>
             <h4> Discrepancies </h4>
                     <p> <b> The Berkeley gas stations don't look like they're in Berkeley. Yikes. </b> </p> <br>
                     <p> When spatial metadata was exported from these image files, latitude and longitude coordinates placed them in the middle of the San Francisco Bay or about 30 miles southwest of Berkeley, around Menlo Park. The reverse geocode process -- which obtains an address from GPS coordinates -- only returned a zip code, with no street information for these files. And that zip code did not match the location of the actual image content, as determined through manual investigation. In the following cases, GPS coordinates on the map correlate to that original (inaccurate) zip code, but the correct street addresses were manually entered into the dataset: </p>
       <br>
        <p><b>Touchless Car Wash</b> at 2176 Kittredge St, Berkeley, CA, 94704 - originally listed at 94025</p>
        <p><b>Coast Gasoline</b> at 3009 Ashby Ave, Berkeley, CA 94705 - originally listed at 94025</p>
        <p><b>No. 1 Gasoline</b> at 1900 Martin Luther King Jr Way, Berkeley, CA 94704 - originally listed at 94063</p>
        <p><b>National Gasoline</b> at 849 University Ave, Berkeley, CA 94710 - originally listed at 94063</p>
        <br>
        <p>This discrepancy serves as an example of inherent data error from the iPhone's GPS coordinate system. With a data set this sample size, manual quality assurance was possible to find these inaccuracies. On a larger scale, however, preemptive check on GPS data from image files during upload & and more refined geocoding during processing could help solve this issue. Additional files may have incorrect GPS coordinates with matching street addresses. </p>
             <h4> Further Reading </h4>
            <p> The DHLab at Yale University's 
                <a href="http://dhlab.yale.edu/projects/photogrammar.html">Photogrammer</a>
                project visualizes an archive of photographs from the United States Farm Security Administration and Office of War Information (FSA-OWI) from 1935â€“1945, and provides a more thoroughly developed instance of organizing, searching, visualizing, and presenting photographic metadata. A 2017 article in 
<a href="http://www.digitalhumanities.org/dhq/vol/11/2/000299/000299.html">Digital Humanities Quarterly</a>
describes their process and findings in further detail. </p>
            <br>
    <p> <a href="https://github.com/mapninja/CV">Stace Maples</a>, a member of the Photogrammer team, is currently at work on a geospatial visualization of <a href="http://www.getty.edu/research/special_collections/notable/ruscha.html"> Ed Ruscha's Streets of Los Angeles Archive </a> at the Getty Research Institute. An initial description of this project is available from the <a href="http://ws-dl.blogspot.com/2017/04/2017-04-17-personal-digital-archiving.html"> Web Sciences and Digital Libraries Research Group at Old Dominion University </a>. 
    <h4> Rights, Reproduction, and Repurposing</h4>
                    <p>All photographs &#169; Dianne Weinthal, 2018. All rights reserved.</p>
                    <p>Unless otherwise stated, all other material including text, tools, and code are open source & available for use. Responsibility for confirming fair use lies with the user.</p>

    </div>
     <div id="contact" class="container">
            <h3>CONTACT</h3>
          If you would like to examine your own archive with this process, learn more about photography / archives / (meta)data visualization, or ask questions -- please don't hesitate to get in touch via email at <a href="mailto:dianne.weinthal@gmail.com" target="_blank">dianne.weinthal@gmail.com</a>
           <br> <br> Gasoline Stations and other image portfolios by Dianne Weinthal are available on <a href="https://dianneweinthal.com/"> dianneweinthal.com </a>
                </div>
    <div id="contributors" class="container">
            <h3> CONTRIBUTORS </h3>
                <h4> Tools </h4>
                    <p> Metadata extracted from Adobe Bridge using <a href="https://www.ps-scripts.com/viewtopic.php?f=72&t=24358&sid=6529114a378b6e37ff888bf74ba105cf#p152285">PS-Script</a></p>
                    <p> Site built on <a href="https://jekyllrb.com/">Jekyll with GitHub pages</a> | forked from  <a href="http://jlord.us/hack-spots/">Hack Spots</a> by <a href="https://twitter.com/jllord">Jessica Lord</a></p>
                    <p> Address data obtained from <a href="https://geoservices.tamu.edu/Services/ReverseGeocoding/BatchProcess/">Texas A&M Geocode Services</a> 
                    <p> Map and data table display powered by <a href="http://jlord.us/sheetsee.js/">Sheetsee.js</a> </p>
                    <p> Image display powered by <a href="https://www.cincopa.com/photos-and-images">Cincopa</a> </p>
                    <p> Visualizations powered by <a href="https://developers.google.com/chart/">Google Charts</a></p>
                <h4> Technical Consultation </h4>
                     <p> <a href="https://dawnchildress.com/">Dawn Childress</a> - Jekyll and IIIF</p>
                     <p> <a href="https://github.com/mapninja/CV">Stace Maples</a> - Geocoding </p>
                     <p> <a href="https://jeremy-zimmett.webnode.com/">Jeremy Zimmett</a> - JSFiddle</p>
                <h4> Acknowledgements </h4>
                     <p> <a href="http://www.johannadrucker.net/">Johanna Drucker</a> and IS289 - classroom support </p>
                     <p> <a href="https://revs.stanford.edu/">Revs Program</a> - initial funding for 2013 photography publication </p>
                     <p> Ed Ruscha's <i>Twenty-six Gasoline Stations</i> - initial inspiration </p>
        </div>
       
    </div><!-- end wrapper -->

    <script id="hackSpotsTable" type="text/html">
        <table>
            <tr><th class="tHeader">Station</th><th class="tHeader">Address</th><th class="tHeader">City</th><th class="tHeader">State</th><th class="tHeader">Country</th><th class="">View</th></tr>
            {{#rows}}
                <tr id="{{rowNumber}}" class="spotRow"><td>{{station}}</td><td>{{address}}</td><td>{{city}}</td><td>{{state}}</td><td>{{country}}</td><td><a class="button" href="https://maps.google.com/maps?q={{address}},{{city}},{{state}}" target="_blank">Google Map</a></td></tr>
            {{/rows}}
        </table>
    </script>

    <script id="latestSpot" type="text/html">
        {{#rows}}
            <h4 class="fauxButton">MOST RECENT SPOT</h4>
            <h2>{{station}}</h2>
            <p class="colorText">{{address}}<p>
            <p class="colorText">{{city}}{{#state}}, {{state}}{{/state}}{{#postcode}}, {{postcode}}{{/postcode}}</p>
            <ul>
                <li><span class="category">Date:</span> {{date}}</li>
                <li><span class="category">Published:</span> {{published}}</li>
                <li><span class="category">Format:</span> {{format}}</li>
            </ul>
            <ul>
                <li><a href="https://maps.google.com/maps?q={{address}},{{city}},{{state}}" target="_blank">View in Google Maps</a></li>
            </ul>
        {{/rows}}
    </script>

    <script id="theNumberofSpots" type="text/html">
        <p><strong>Data set includes <span class="red-text">{{numberOfSpots}}</span> gas station photographs</p>
    </script>

    <script id="selectedSpot" type="text/html">
        {{#rows}}
            <h4 class="fauxButton">SELECTED SPOT</h4>
            <h2>{{station}}</h2>
            <p class="colorText">{{address}}<p>
            <p class="colorText">{{city}}{{#state}}, {{state}}{{/state}}{{#postcode}}, {{postcode}}{{/postcode}}</p>
            <ul>
                <li><span class="category">Date:</span> {{date}}</li>
                <li><span class="category">Published:</span> {{published}}</li>
                <li><span class="category">Format:</span> {{format}}</li>
            </ul>
            <ul>
                <li><a href="https://maps.google.com/maps?q={{address}},{{city}},{{state}}" target="_blank">View in Google Maps</a></li>
            </ul>
        {{/rows}}
   
    </script>
    
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var gData
            var URL = "1bsqzhvvRqvrhDRYkiqRiApKSIC7bojCXlRPPEX7pVaE"
                Tabletop.init({ key: URL, callback: showInfo, simpleSheet: true })
        })

        // so long, so messy
        function showInfo(gData) {
            tableOptions = {
                "data": gData,
                "tableDiv": "#hackSpotsTable",
                "filterDiv": "#tableFilter"
            }
            // make the table, and the search bar
            Sheetsee.makeTable(tableOptions)
            Sheetsee.initiateTableFilter(tableOptions)

            // create geoJSON with coordinates and other
            // useful bits from the original data
            var optionsJSON = ["station", "address", "city", "rowNumber"]
            var geoJSON = Sheetsee.createGeoJSON(gData, optionsJSON)

            // create map, tilelayer (map background), markers and popups
            var map = Sheetsee.loadMap("map")
            Sheetsee.addTileLayer(map, 'jllord.n7aml2bc')
            var markerLayer = Sheetsee.addMarkerLayer(geoJSON, map, "<h2>{{ station }}</h2>", true)

            // find the latest spot with the most important
            // info filled in (to prevent map breaking if
            // someone is currently editing spreadsheet)
            var theLatestSpot = findLatestCompleteSpot(gData)
            var latestSpot = Sheetsee.ich.latestSpot({
                rows: theLatestSpot
            })
            // set it and pan to it
            $('#latestSpot').html(latestSpot)
            map.setView([theLatestSpot.lat, theLatestSpot.long], 14)

            // when someone clicks on a row, highlight it and
            // re-center the map
            // TODO show popup, change marker color
            $('.spotRow').live("click", function(event) {
                $('.spotRow').removeClass("selectedRow")
                var rowNumber = $(this).closest("tr").attr("id")
                $('#' + rowNumber).addClass("selectedRow")
                var dataElement = Sheetsee.getMatches(gData, rowNumber, "rowNumber")
                var selectedSpot = Sheetsee.ich.selectedSpot({
                    rows: dataElement
                })
                $('#latestSpot').css("display", "none")
                $('#selectedSpot').html(selectedSpot).css("display", "inline")
                var selectedCoords = [dataElement[0].lat, dataElement[0].long]
                map.setView(selectedCoords, 14)
            })

            // so that the first map and info that loads
            // is complete and doesn't show rows that are
            // actively being edited by folk
            function findLatestCompleteSpot(data) {
                var latestCompleteSpot = []
                var startWithLatestRow = data.reverse()
                startWithLatestRow.forEach(function(row){
                    if (!row.lat || !row.long || !row.station || !row.address || !row.city || !row.state ) return
                    else latestCompleteSpot.push(row)
                })
                return latestCompleteSpot[0]
            }

            // Add click listener to the markerLayer
            markerLayer.on('click', function(e) {
                // clear any selected rows
                $('.spotRow').removeClass("selectedRow")
                // get row number of selected marker
                var rowNumber = e.layer.feature.opts.rowNumber
                // find that row in the table and make consider it selected
                $('#' + rowNumber).addClass("selectedRow")
                // using row number, get the data for the selected spot
                var dataElement = Sheetsee.getMatches(gData, rowNumber.toString(), "rowNumber")
                // take those details and re-write the selected spot section
                var selectedSpot = Sheetsee.ich.selectedSpot({
                    rows: dataElement
                })
                // center the map on the selected element
                map.panTo([dataElement[0].lat, dataElement[0].long])
                // update the spot listing
                $('#latestSpot').css("display", "none")
                $('#selectedSpot').html(selectedSpot).css("display", "inline")
            })

            // reset the map, zoom out, and recenter on 0,0
            $('.resetMap').click(function() {
                $('.spotRow').removeClass("selectedRow")
                $('#latestSpot').css("display", "inline")
                $('#selectedSpot').css("display", "none")
                map.setView([0,0], 1)
            })

            // find total number of spots added
            var theNumberofSpots = Sheetsee.ich.theNumberofSpots({
                numberOfSpots: gData.length
            })
            $('#theNumberofSpots').html(theNumberofSpots)

            if(window.location.hash) {
                $('#tableFilter').val(window.location.hash.substring(1)).keyup()
                $('.spotRow').first().click()
            }
        }

        $(document).on('keyup', '#tableFilter', function() {
            window.location.hash = $(this).val()
            $('.spotRow').first().click()
        })
    </script>
</body>
</html>
